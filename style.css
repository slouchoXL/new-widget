:root{
  /* core sizing the whole layout reads */
  --packW: 420px;        /* desktop visual width of the stage/pack */
  --gapX: 16px;          /* tray column gap AND row gap */
  --pad:  10px;          /* side padding inside stage (safety on small) */

  /* derived: 3 columns that fit within the stage width */
  --thumbW: calc((var(--packW) - 2*var(--pad) - 2*var(--gapX)) / 3);

  /* stack card width as a % of the stage (tweak to taste) */
  --stackW: 55%;

  /* typography/colors */
  --bg:#0a0a0a; --card:#121212; --text:#eaeaea; --muted:#9aa0a6; --btn:#3b82f6;
}

*{ box-sizing: border-box; }
html,body{
  margin:0; background:#000; color:var(--text);
  font-family:system-ui, -apple-system, Inter, Roboto, Arial, sans-serif;
}

/* widget shell */
.widget{
  display:grid;
  grid-template-rows: auto 1fr auto;
  gap: 8px;
  width: min(1060px, 96vw);
  margin: 0 auto;
  padding: 12px;
  background: var(--card);
  border: 1px solid #222;
  border-radius: 12px;
}

/* meta tight ABOVE the pack */
.meta{
  display:grid; gap: 2px; text-align:center; margin-bottom: 2px;
}
.meta .balance, .meta .price{ color:var(--muted); font-size:14px; }

/* stage centers pack and animations; fixed width by --packW */
.stage{ display:grid; place-items:center; }
.anchor{
  position: relative;
  width: var(--packW);
  aspect-ratio: 10 / 7;  /* pack image ratio */
  isolation: isolate;    /* clean z-index layers */
  margin: 0 auto;
  padding-inline: var(--pad);
}

/* pack image */
.pack-img{
  display:block; width:100%; height:100%; object-fit:contain;
  filter: drop-shadow(0 20px 40px rgba(0,0,0,.45));
}
.pack-img[hidden]{ display:none; }

/* actions tight BELOW */
.actions{ display:grid; place-items:center; margin-top: 4px; }
.btn{
  padding:.6rem 1rem; border-radius:9px; border:1px solid #2a2a2a;
  background:var(--btn); color:#fff; font-weight:700; cursor:pointer;
}
.btn:disabled{ opacity:.6; cursor:not-allowed; filter:saturate(.6); }

/* ----- STACK (5 cards layered, centered in anchor) ----- */
#stack{
  position: absolute; inset: 0; z-index: 20;
}
#stack[hidden]{ display:none; }
#stack .stack-card{
  position: absolute; left:50%; top:50%; transform: translate(-50%,-50%);
  width: var(--stackW);           /* relative to stage width */
  aspect-ratio: 5 / 7;
  border-radius: 12px; overflow: hidden;
  border: 1px solid #2a2a2a; background:#0d0d0d; cursor:pointer;
}
#stack .stack-card img{
  width:100%; height:100%; object-fit:cover; pointer-events:none;
}

/* ----- TRAY (3 on top, 2 centered below, fits the stage) ----- */
#tray{
  position: absolute; inset: 0; z-index: 10;
  display:grid; place-items:center;
  grid-template-columns: repeat(3, var(--thumbW));
  grid-auto-rows: calc(var(--thumbW) * 1.4); /* 5:7 ratio */
  gap: var(--gapX);
  justify-content:center; align-content:center;
}
#tray[hidden]{ display:none; }

#tray .tray-card{
  width: var(--thumbW);
  height: calc(var(--thumbW) * 1.4);
  border-radius: 12px; border: 1px solid #2a2a2a;
  background:#0d0d0d; overflow:hidden; padding:0; cursor:pointer;
}
#tray .tray-card img{ width:100%; height:100%; object-fit:cover; }

/* 3 on first row */
#tray .tray-card[data-pos="1"]{ grid-column:1; grid-row:1; }
#tray .tray-card[data-pos="2"]{ grid-column:2; grid-row:1; }
#tray .tray-card[data-pos="3"]{ grid-column:3; grid-row:1; }
/* 2 centered second row */
#tray .tray-card[data-pos="4"]{ grid-column:1 / span 2; grid-row:2; justify-self:center; }
#tray .tray-card[data-pos="5"]{ grid-column:2 / span 2; grid-row:2; justify-self:center; }

/* dim non-active cards when preview is open */
#tray.has-preview .tray-card{ opacity:.35; filter:saturate(.8); pointer-events:none; }
#tray.has-preview .tray-card.is-active{ opacity:1; filter:none; pointer-events:auto; z-index:50; }

/* ----- OVERLAY (enlarged card stays inside the stage) ----- */
.overlay{
  position:absolute; inset:0; display:grid; place-items:center; z-index:40;
}
.overlay[hidden]{ display:none; }
.overlay-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(2px);
}
.overlay-card{
  position:relative; z-index:42;
  width: min(90%, var(--packW));
  max-height: 90%;
  border:1px solid #2a2a2a; background:#0b0b0b;
  border-radius:12px; padding:8px; display:grid;
}
.overlay-card img{ width:100%; aspect-ratio:5 / 7; object-fit:cover; }

/* error toast */
.error[hidden]{ display:none; }
.error{
  margin-top:8px; padding:10px 12px; border-radius:8px;
  border:1px solid #4a1d1d; background:#2a1111; color:#ffb4b4; text-align:center;
}

/* Responsive tightenings */
@media (max-width: 900px){
  :root{ --packW:340px; --gapX:12px; --pad:8px; --stackW:40%; }
}
@media (max-width: 600px){
  :root{ --packW:240px; --gapX:8px; --pad:10px; --stackW:40%; }
  .meta{ margin-bottom:2px; }
  .actions{ margin-top:2px; }
}
