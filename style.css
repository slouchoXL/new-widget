:root{
  /* core sizing the whole layout reads */
  --packW: 420px;     /* desktop */
  --thumbW: 180px;    /* tray thumb width */
  --gapX: 16px;       /* tray column gap AND row gap */
  --pad:  10px;       /* side padding inside stage (safety on small) */

  /* typography/colors */
  --bg:#0a0a0a; --card:#121212; --text:#eaeaea; --muted:#9aa0a6; --btn:#3b82f6;
}

*{ box-sizing: border-box; }
html,body{ margin:0; background:#000; color:var(--text); font-family:system-ui, -apple-system, Inter, Roboto, Arial, sans-serif; }

/* widget shell */
.widget{
  display:grid;
  grid-template-rows: auto 1fr auto;
  gap: 8px;
  width: min(1060px, 96vw);
  margin: 0 auto;
  padding: 12px;
  background: var(--card);
  border: 1px solid #222;
  border-radius: 12px;
}

/* meta tight ABOVE the pack */
.meta{
  display:grid; gap: 2px;
  text-align:center;
  margin-bottom: 2px;    /* ← tight */
}
.meta .balance{ color:var(--muted); font-size:14px; }
.meta .price{ color:var(--muted); font-size:14px; }

/* stage centers pack and tray; fixed visual width by --packW */
.stage{ display:grid; place-items:center; }
.anchor{
  position: relative;
  width: calc(var(--packW) + 2*var(--pad));
  padding-inline: var(--pad);
}

/* pack image – NEVER squish */
.pack-img{
  display:block;
  width: var(--packW);
  aspect-ratio: 10 / 7;        /* 1400x2000 -> 2000/1400 ≈ 1.4286 */
  object-fit: contain;
  margin: 0 auto;
  filter: drop-shadow(0 20px 40px rgba(0,0,0,.45));
}

/* actions tight BELOW the pack */
.actions{
  display:grid; place-items:center;
  margin-top: 4px;             /* ← tight */
}
.btn{
  padding:.6rem 1rem; border-radius:9px; border:1px solid #2a2a2a;
  background:var(--btn); color:#fff; font-weight:700; cursor:pointer;
}
.btn:disabled{ opacity:.6; cursor:not-allowed; filter:saturate(.6); }

/* tray grid (3 + 2 centered) */
.tray{
  display:grid;
  grid-template-columns: repeat(3, var(--thumbW));
  grid-auto-rows: calc(var(--thumbW) * 1.4);   /* 5:7 ratio */
  gap: var(--gapX);
  justify-content:center;
  align-content:center;
  margin: 10px auto 2px;
}
.card{
  width: var(--thumbW);
  height: calc(var(--thumbW) * 1.4);
  border-radius: 12px; border: 1px solid #2a2a2a; background:#0d0d0d;
  overflow:hidden; padding:0; cursor:pointer;
}
.card img{ width:100%; height:100%; display:block; object-fit:cover; }

/* 3 on top */
.tray .card:nth-child(1){ grid-column:1; grid-row:1; }
.tray .card:nth-child(2){ grid-column:2; grid-row:1; }
.tray .card:nth-child(3){ grid-column:3; grid-row:1; }
/* 2 centered on second row (“1.5, 2.5” look) */
.tray .card:nth-child(4){ grid-column:1 / span 2; grid-row:2; justify-self:center; }
.tray .card:nth-child(5){ grid-column:2 / span 2; grid-row:2; justify-self:center; }

/* overlay (enlarged card) – inside widget, centered, closes on click */
.overlay{ position:relative; }
.overlay[hidden]{ display:none; }
.overlay-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.55);
}
.overlay-card{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(560px, 92%);
  border:1px solid #2a2a2a; background:#0f1115; border-radius:14px; padding:16px;
}
.overlay-card img{
  width:100%; aspect-ratio: 5 / 7; object-fit:cover; display:block;
}

/* error toast */
.error[hidden]{ display:none; }
.error{
  margin-top:8px; padding:10px 12px; border-radius:8px; border:1px solid #4a1d1d;
  background:#2a1111; color:#ffb4b4; text-align:center;
}

/* ===== Responsive: phone-first tightening ===== */
@media (max-width: 900px){
  :root{
    --packW: 340px;
    --thumbW: 160px;
    --gapX: 12px;
    --pad: 8px;
  }
}
@media (max-width: 600px){
  :root{
    --packW: 240px;    /* you said this felt right */
    --thumbW: 130px;
    --gapX: 8px;       /* row gap == col gap */
    --pad: 10px;       /* keeps tray off edges */
  }
  .meta{ margin-bottom: 2px; }
  .actions{ margin-top: 2px; }
}

/* Stage pieces */
.stage .anchor { position: relative; width: min(420px, 92vw); margin: 0 auto; }
.pack-img      { width: 100%; height: auto; display: block; }

/* Stack lives centered, cards are absolute in it */
.stack{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: auto;
  z-index: 20;
}
.stack .card{
  position: absolute;
  width: 72%;
  aspect-ratio: 5 / 7;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #2a2a2a;
  background: #0d0d0d;
  cursor: pointer;
}
.stack .card img{
  width: 100%; height: 100%; object-fit: cover; pointer-events: none;
}

/* Tray replaces the pack inside the same anchor */
.tray{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 10;
}
.tray-grid{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  column-gap: 10px;
  row-gap: 10px;
  width: 100%;
  padding-inline: 10px;           /* keep off edges on mobile */
  max-width: 100%;
  justify-items: center;
}
.tray .card{
  position: static;
  width: 100%;
  aspect-ratio: 5 / 7;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #2a2a2a;
  background: #0d0d0d;
  padding: 0;
}
.tray .card img{ width: 100%; height: 100%; object-fit: cover; display: block; }

/* Dim rest of tray while preview open */
.tray.has-preview .card{ opacity: .35; filter: saturate(.8); pointer-events: none; }
.tray.has-preview .card.is-active{ opacity: 1; filter: none; pointer-events: auto; z-index: 50; }

/* In-stage overlay (sits on top of stack/tray, inside the anchor bounds) */
.overlay{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 40;
}
.overlay-backdrop{
  position: absolute; inset: 0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(2px);
}
.overlay-card{
  position: relative;
  z-index: 42;
  width: min(560px, 90%);
  padding: 10px;
  border-radius: 12px;
  background: #0b0b0b;
  border: 1px solid #2a2a2a;
}
.overlay-card img{ width: 100%; aspect-ratio: 5 / 7; object-fit: cover; }

/* Keep CTA close to stage by default (you can tweak further if needed) */
.actions{ margin-top: 8px; }
@media (max-width: 600px){
  .actions{ margin-top: 4px; }
}
